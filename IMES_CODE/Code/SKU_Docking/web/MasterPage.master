<%@ Master Language="C#" AutoEventWireup="true" CodeFile="MasterPage.master.cs" Inherits="MasterPage" %>

<%@ Import Namespace="com.inventec.iMESWEB" %>
<!doctype html>
<html>
<head runat="server">
    <title>MasterPage</title>

    <script type="text/javascript" src=" ../CommonControl/JS/Browser.js"></script>
    <script type="text/javascript" src=" ../CommonControl/JS/iMESCommonUse.js"></script>
  <script type="text/javascript" src="../CommonControl/jquery/js/jquery-1.7.1.min.js"></script>    
    
     <script type="text/javascript" src="../CommonControl/jquery/js/jquery.url.js"></script>
    <script type="text/javascript" src="../CommonControl/IMESUti/IMESUti.Url.js"></script>
     <script type="text/javascript" src="../CommonControl/IMESUti/IMESUti.Print.js"></script>
    <script language="javascript" type="text/javascript">
  
  
     function getClientHostName()
    {
        var WshNetwork = new ActiveXObject("WScript.Network");
        var hostnameLocal= WshNetwork.ComputerName.toLowerCase();
        if(hostnameLocal==null)
        {
            hostnameLocal="";
        }
        
        if(hostnameLocal.trim()=="")
        {
            var message='Found host name failed,please check!';
            alert(message); 
        }
        return hostnameLocal;
    }
    
    </script>

</head>
<body style=" position: relative;">
    <bgsound src="" autostart="true" id="bsound"></bgsound>
    <form id="form1" runat="server">
    <object classid="clsid:{24BB7CDB-562E-4D60-8A56-4DD1DD77BE48}" codebase="../CommonControl/print.cab#version=<%=WebConstant.version%>"
        id="objPrint" style="margin: 0; padding: 0; display: none;">
    </object>
    <object classid="clsid:648A5600-2C6E-101B-82B6-000000000014" codebase="../CommonControl/MSCOMM32.cab" id="objMSComm" style="margin: 0; padding: 0; display: none;">
        <param name="_ExtentX" value="1005" /><param name="_ExtentY" value="1005" /><param name="_Version" value="393216" /><param name="CommPort" value="1" />
        <param name="DTREnable" value="-1" /><param name="Handshaking" value="0" /><param name="InBufferSize" value="1024" /><param name="InputLen" value="0" />
        <param name="NullDiscard" value="0" /><param name="OutBufferSize" value="512" /><param name="ParityReplace" value="63" /><param name="RThreshold" value="0" />
        <param name="RTSEnable" value="0" /><param name="BaudRate" value="9600" /><param name="ParitySetting" value="1" /><param name="DataBits" value="7" />
        <param name="StopBits" value="0" /><param name="SThreshold" value="0" /><param name="EOFEnable" value="0" /><param name="InputMode" value="0" />
    </object>

    <div id="div_center" class="iMes_div_center">
        <asp:ContentPlaceHolder ID="iMESContent" runat="server">
        </asp:ContentPlaceHolder>
    </div>
    <asp:ScriptManagerProxy ID="ScriptManagerProxy1" runat="server">
        <Services>
            <asp:ServiceReference Path="~/Service/PrintService.asmx" />
        </Services>
    </asp:ScriptManagerProxy>
    <div style="height: 1px">
    </div>
    <div align="center" >
        <textarea id="MessageTextArea" class="iMes_Master_msgbox" readonly="readOnly" tabindex="2" style="height:100px"
            runat="server"></textarea>
        <script language="javascript" type="text/javascript">
            function ShowInfo(message,statusColor) {
                var obj = document.getElementById("<%=MessageTextArea.ClientID %>");
                                
                if (statusColor) {
                    obj.style.color = statusColor;
                }
                else obj.style.color = "red";
                
                obj.value = message;
            }     
            function ShowErrorInfo(message, isPlaySound, playTimes) {
                var obj = document.getElementById("<%=MessageTextArea.ClientID %>");
                obj.style.color = "red";
                obj.value = message;
                if (isPlaySound) {
                    m_playFailSound(playTimes);
                }
                  
            }        
        </script>
    </div>
    <div align="center">
    <table>
        <tr>

            <td style="width: 50%;" align="center">
                <asp:UpdatePanel ID="updatePanel1" runat="server">
                    <ContentTemplate>
                    <asp:Label ID="BtnDownloadBat" runat="server" ForeColor="Green"></asp:Label>
                    </ContentTemplate>
                </asp:UpdatePanel>
            </td>
             <td style="width: 50%;" align="center">
              <asp:UpdatePanel ID="updatePanel2" runat="server">
                    <ContentTemplate>
                        <asp:LinkButton ID="lbtFreshPage" runat="server" OnClientClick="return ReloadImesPage();" ></asp:LinkButton>
                    </ContentTemplate>
                </asp:UpdatePanel>
            </td>
        </tr>
    </table>
    </div>
    <iMES:WaitingCoverDiv ID="divCover" runat="server"  KeyDownFun="KeyDownEvent()"  />
    <div id="hiddenArea">
        <asp:UpdatePanel ID="updatePanelStation" runat="server">
            <ContentTemplate>
                <input id="hiddenStation" type="hidden" runat="server" />
                <input type="hidden" runat="server" id="hiddenPCode" /> 
                
            </ContentTemplate>
        </asp:UpdatePanel>
    </div>
    </form>
</body>
</html>

<script language="javascript" type="text/javascript">
if (browser.msie && browser.version == "6.0") {
    document.body.style.width = "98%";
}
else {
    document.body.style.width = "100%";
}

var msgSucc = '<%=Resources.iMESGlobalMessage.ResourceManager.GetString(WebCommonMethod.getConfiguration(WebConstant.LANGUAGE) + "_msgSuccess") %>';
var BatFileNotExist = '<%=Resources.iMESGlobalMessage.ResourceManager.GetString(WebCommonMethod.getConfiguration(WebConstant.LANGUAGE) + "_BatNoExist") %>';
var PrinterOrBatNotExit='<%=Resources.iMESGlobalMessage.ResourceManager.GetString(WebCommonMethod.getConfiguration(WebConstant.LANGUAGE) + "_PrinterOrBatNotExit") %>';
var msgLabelTypeChange= '<%=Resources.iMESGlobalMessage.ResourceManager.GetString(WebCommonMethod.getConfiguration(WebConstant.LANGUAGE) + "_msgLabelTypeChange") %>';
//play sound function
var soundUrl = '../Sound/' + '<%=System.Configuration.ConfigurationManager.AppSettings["PassAudioFile"] %>';
var specialSoundUrl = '../Sound/' + '<%=System.Configuration.ConfigurationManager.AppSettings["SpecialPassAudioFile"] %>';
var ClientBatFilePath = '<%=System.Configuration.ConfigurationManager.AppSettings["ClientBatFilePath"]%>';
var CartonWeightConfigFilePath = '<%=System.Configuration.ConfigurationManager.AppSettings["CartonWeightConfigFilePath"]%>';
var PaletWeightConfigFilePath = '<%=System.Configuration.ConfigurationManager.AppSettings["PalletWeightConfigFilePath"]%>';
var failSoundUrl = '../Sound/' + '<%=System.Configuration.ConfigurationManager.AppSettings["FailAudioFile"] %>';
var ClientBartenderFilePath = '<%=System.Configuration.ConfigurationManager.AppSettings["ClientBartenderFilePath"]%>';

function m_playFailSound(playTimes) {
    var obj = getSoundObj();
    obj.loop=2;
    if (playTimes) {  
    obj.loop= playTimes;
    }
    obj.src = failSoundUrl;
   
}

function m_playSound(bSpecial)
{
    var obj = getSoundObj();
    if (bSpecial) {
        obj.src = specialSoundUrl;
    }
    else {
        obj.src = soundUrl;
    }
}
function c_playSound(bSpecial)
{
    var obj = getSoundObj();
    if (bSpecial) {
        obj.src = bSpecial;
    }
    else {
        obj.src = soundUrl;
    }
}
function ShowSuccessfulInfoWithColor(isPlaySound, message, isSpecialSound,color) {
    var obj = document.getElementById("<%=MessageTextArea.ClientID %>");
    if (color == "")
    { obj.style.color = "green"; }
    else
    { obj.style.color = color; }
   
    if (arguments.length == 1) {
        message = msgSucc;
    }
    //ShowInfo(message);
    obj.value = message;

    if (isPlaySound) {
        m_playSound(isSpecialSound);
    }
    //obj.style.color = "red";
}


  function ShowSuccessfulInfo(isPlaySound, message, isSpecialSound)
{
    var obj = document.getElementById("<%=MessageTextArea.ClientID %>");
    obj.style.color= "green";
   if (arguments.length == 1)
   {
        message = msgSucc;
   }
   //ShowInfo(message);
   obj.value = message;
   
   if (isPlaySound) {
        m_playSound(isSpecialSound);
    }
    //obj.style.color = "red";
}
  function ShowCompleteInfo(isPlaySound, message, isSpecialSound)
{
    var obj = document.getElementById("<%=MessageTextArea.ClientID %>");
    obj.style.color= "green";
   if (arguments.length == 1)
   {
        message = msgSucc;
   }
   //ShowInfo(message);
   obj.value = message;
   
   if (isPlaySound) {
        c_playSound(isSpecialSound);
    }
    //obj.style.color = "red";
}
function GetCommonInfo()
{
    return document.getElementById("<%=MessageTextArea.ClientID %>").value;
}

function setGetInfoTextHeight(txtAheight)
{
    document.getElementById("<%=MessageTextArea.ClientID %>").style.height = txtAheight;
}

function getSoundObj()
{
    return document.getElementById("bsound");
}

function setGetInfoTextHeight(txtAheight)
{
    document.getElementById("<%=MessageTextArea.ClientID %>").style.height = txtAheight;
}

function HideInfoText()
{
    document.getElementById("<%=MessageTextArea.ClientID %>").style.display = "none";
}

function HideInfoTextAndLabelBatFresh()
{
    document.getElementById("<%=MessageTextArea.ClientID %>").style.display = "none";
	document.getElementById("<%=BtnDownloadBat.ClientID %>").style.display = "none";
	document.getElementById("<%=lbtFreshPage.ClientID %>").style.display = "none";
}

function DisplayInfoText()
{
    document.getElementById("<%=MessageTextArea.ClientID %>").style.display = "";
}

function GetSuccessMessage(desc, param) {
    var message = "";
    var msgSuccess = '<%=Resources.iMESGlobalMessage.ResourceManager.GetString(WebCommonMethod.getConfiguration(WebConstant.LANGUAGE) + "_msgSuccess") %>';
    message = "[" + desc + ":" + param + "] " + msgSuccess;
    return message;
}

function ShowSuccessfulInfoFormat(isPlaySound, desc, param) {
    var message = "";
    var msgSuccess = '<%=Resources.iMESGlobalMessage.ResourceManager.GetString(WebCommonMethod.getConfiguration(WebConstant.LANGUAGE) + "_msgSuccess") %>';
    //message = "[" + desc + " : " + param + "] " + msgSuccess;
    message = "[" + param + "] " + msgSuccess;
    ShowSuccessfulInfo(isPlaySound, message);
}

function ShowSuccessfulInfoFormatDetail(isPlaySound,prestr, desc, param,detail) {
    var message = "";
    var msgSuccess = '<%=Resources.iMESGlobalMessage.ResourceManager.GetString(WebCommonMethod.getConfiguration(WebConstant.LANGUAGE) + "_msgSuccess") %>';
    //message = "[" + desc + " : " + param + "] " + msgSuccess;
    message = prestr + " [" + param + "] " + msgSuccess;  
    if (detail != null && detail != "") {
        message = message + " (" + detail + ")";
    }
    ShowSuccessfulInfo(isPlaySound, message);
}

function ShowSpecialSuccessfulInfoFormatDetail(isPlaySound, prestr, desc, param, detail) {
    var message = "";
    var msgSuccess = '<%=Resources.iMESGlobalMessage.ResourceManager.GetString(WebCommonMethod.getConfiguration(WebConstant.LANGUAGE) + "_msgSuccess") %>';
    //message = "[" + desc + " : " + param + "] " + msgSuccess;
    message = prestr + " [" + param + "] " + msgSuccess;
    if (detail != null && detail != "") {
        message = message + " (" + detail + ")";
    }
    ShowSuccessfulInfo(isPlaySound, message, true);
}
</script>

<script language="javascript" type="text/javascript">

//////// add by itc-208014 Get Print Data  /////////// Get Print Data Begining //////////////////////////////////////////

   var MasterStation="";
   var MasterPCode="";
   var LabelTypeLst= new Array ();
   var CookieLst= new Array ();
   var PrinterLst=new Array ();            
   var SUCCESSRET ="SUCCESSRET";
   var printers="";
   var xdpi="";
   var ydpi="";
   var XDPILst = new Array ();
   var YDPILst = new Array ();
   var LabelTypeLstLength="";
   var PreLanguage = "";
   var mpUserInfo = new MpUserInfo();

   function MpUserInfo() {
       this.UserId = '<%=Request["UserId"] %>';
       this.UserName = '<%=Request["UserName"] %>';
       this.Customer = '<%=Request["Customer"] %>';
       this.AccountId = '<%=Request["AccountId"] %>';
       this.Login = '<%=Request["Login"] %>';
       this.PCode = '<%=Request["PCode"] %>';
       this.Station = '<%=Request["Station"] %>';
       this.SessionId = '<%=Request["SessionId"] %>';
   }
   function prepareForPrint()
   {
       var NeedPrint = '<%=NeedPrint %>';
       if(NeedPrint.toLowerCase() == 'false'){
         return false;
       }
       MasterStation=document.getElementById("<%=hiddenStation.ClientID %>").value;
       MasterPCode=document.getElementById("<%=hiddenPCode.ClientID %>").value;

       GetPrinterLst();
       GetDPILst();
       GetLabelTypeLst();
        
   }
   
   function GetPrinterLst()
   {
      printers=document.getElementById("objPrint").getPrintList();
      PrinterLst=printers.split(";");
   }
   
   function GetDPILst()
   {
     for (i=0; i< PrinterLst.length; i++)
     {   
         var x = "x";
         xdpi = document.getElementById("objPrint").getPrinterDPI(PrinterLst[i],x);
         if ((xdpi!="")||(xdpi=null))
         {
            XDPILst.push(xdpi);
         }
         
         var y = "y";
         ydpi = document.getElementById("objPrint").getPrinterDPI(PrinterLst[i],y);
         if ((ydpi!="")||(ydpi=null))
         {
            YDPILst.push(ydpi);
         }
      }
   }
  
  
  function GetLabelTypeLst()
   {
      if(MasterPCode!="")
      {
        
        PrintService.GetLabelTypeList(MasterPCode,onLabelTypeSuccess,onLabelTypeFailed);
        
      }
   }
  
   function onLabelTypeSuccess(result)
    {
     try
      { 
       if((result.length==3)&&(result[0]==SUCCESSRET))
        {
        
           for (i=0; i< result[1].length; i++)
             {
                 LabelTypeLst.push(result[1][i]);   
                
             }

             LabelTypeLstLength = LabelTypeLst.length;
           TransferMasterData(LabelTypeLst,PrinterLst,XDPILst,YDPILst,LabelTypeLstLength,MasterPCode,MasterStation,result[2]);
  
       }
        
        else
        {
           LabelTypeLst="";
           LabelTypeLstLength="";
        }
        
      }
    
      catch (e) 
      {
        alert(e.description);
      }
      
    }

    
    function onLabelTypeFailed(error)
    {
       try 
       {
        ShowMessage(error.get_message());
        ShowInfo(error.get_message());
       }
       catch (e)
       {
        alert(e.description);
       } 
    }

    prepareForPrint();
    
</script>

